<UserControl x:Class="SmartAlloc.Views.BudgetsView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:vm="clr-namespace:SmartAlloc.ViewModels"
             Background="{DynamicResource BackgroundBrush}">

    <ScrollViewer Style="{StaticResource ScrollViewerStyle}">
        <Grid Margin="28,20,28,28">
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="*"/>
            </Grid.RowDefinitions>

            <!-- Header -->
            <StackPanel Grid.Row="0" Margin="0,0,0,4">
                <TextBlock Text="Budgets" Style="{StaticResource PageTitleStyle}"/>
                <TextBlock Text="Control your monthly spending limits" Style="{StaticResource PageSubtitleStyle}"/>
            </StackPanel>

            <!-- Add Budget -->
            <Border Grid.Row="1" Style="{StaticResource GlassCardStyle}" Margin="0,0,0,20">
                <Grid>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="Auto"/>
                        <ColumnDefinition Width="12"/>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="12"/>
                        <ColumnDefinition Width="120"/>
                        <ColumnDefinition Width="12"/>
                        <ColumnDefinition Width="100"/>
                        <ColumnDefinition Width="12"/>
                        <ColumnDefinition Width="100"/>
                        <ColumnDefinition Width="12"/>
                        <ColumnDefinition Width="Auto"/>
                    </Grid.ColumnDefinitions>

                    <TextBlock Grid.Column="0" Text="➕ New budget:" FontSize="13"
                               Foreground="{DynamicResource TextSecondaryBrush}" VerticalAlignment="Center"/>

                    <ComboBox Grid.Column="2"
                              ItemsSource="{Binding Categories}"
                              SelectedItem="{Binding SelectedCategory}"
                              Style="{StaticResource DarkComboStyle}"/>

                    <StackPanel Grid.Column="4">
                        <TextBlock Text="Limit (PLN)" Style="{StaticResource LabelStyle}"/>
                        <TextBox Text="{Binding NewLimit, StringFormat={}{0:N2}, UpdateSourceTrigger=PropertyChanged}"
                                 Style="{StaticResource DarkInputStyle}"/>
                    </StackPanel>

                    <StackPanel Grid.Column="6">
                        <TextBlock Text="Month" Style="{StaticResource LabelStyle}"/>
                        <TextBox Text="{Binding SelectedMonth, UpdateSourceTrigger=PropertyChanged}"
                                 Style="{StaticResource DarkInputStyle}"/>
                    </StackPanel>

                    <StackPanel Grid.Column="8">
                        <TextBlock Text="Year" Style="{StaticResource LabelStyle}"/>
                        <TextBox Text="{Binding SelectedYear, UpdateSourceTrigger=PropertyChanged}"
                                 Style="{StaticResource DarkInputStyle}"/>
                    </StackPanel>

                    <Button Grid.Column="10"
                            Content="Save budget"
                            Command="{Binding AddOrUpdateBudgetCommand}"
                            Style="{StaticResource PrimaryButtonStyle}"
                            VerticalAlignment="Bottom"/>
                </Grid>
            </Border>

            <!-- Budget Items -->
            <ItemsControl Grid.Row="2" ItemsSource="{Binding BudgetItems}">
                <ItemsControl.ItemsPanel>
                    <ItemsPanelTemplate>
                        <WrapPanel/>
                    </ItemsPanelTemplate>
                </ItemsControl.ItemsPanel>
                <ItemsControl.ItemTemplate>
                    <DataTemplate DataType="{x:Type vm:BudgetItem}">
                        <Border Style="{StaticResource GlassCardStyle}"
                                Width="280" Margin="0,0,16,16">
                            <Grid>
                                <Grid.RowDefinitions>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="Auto"/>
                                </Grid.RowDefinitions>

                                <Grid Grid.Row="0" Margin="0,0,0,12">
                                    <TextBlock Text="{Binding CategoryName}"
                                               FontSize="14" FontWeight="SemiBold"
                                               Foreground="{DynamicResource TextPrimaryBrush}"/>
                                    <Button Content="✕"
                                            Command="{Binding DataContext.DeleteBudgetCommand,
                                                RelativeSource={RelativeSource AncestorType=ItemsControl}}"
                                            CommandParameter="{Binding}"
                                            Background="Transparent" BorderThickness="0"
                                            Foreground="{DynamicResource TextMutedBrush}"
                                            Cursor="Hand" FontSize="12"
                                            HorizontalAlignment="Right" Padding="4"/>
                                </Grid>

                                <Grid Grid.Row="1" Margin="0,0,0,8">
                                    <TextBlock FontSize="12" Foreground="{DynamicResource TextSecondaryBrush}">
                                        <Run Text="{Binding Spent, StringFormat={}{0:N2} PLN, Mode=OneWay}"/>
                                        <Run Text=" / "/>
                                        <Run Text="{Binding MonthlyLimit, StringFormat={}{0:N2} PLN, Mode=OneWay}"/>
                                    </TextBlock>
                                    <TextBlock Text="{Binding UsagePercent, StringFormat={}{0:N0}%}"
                                               FontSize="12" FontWeight="SemiBold"
                                               HorizontalAlignment="Right">
                                        <TextBlock.Foreground>
                                            <SolidColorBrush Color="{Binding StatusColor}"/>
                                        </TextBlock.Foreground>
                                    </TextBlock>
                                </Grid>

                                <ProgressBar Grid.Row="2"
                                             Value="{Binding UsagePercent, Mode=OneWay}"
                                             Maximum="100"
                                             Style="{StaticResource ProgressBarStyle}"
                                             Height="10" Margin="0,0,0,10">
                                    <ProgressBar.Foreground>
                                        <SolidColorBrush Color="{Binding StatusColor}"/>
                                    </ProgressBar.Foreground>
                                </ProgressBar>

                                <TextBlock Grid.Row="3"
                                           FontSize="11"
                                           Foreground="{DynamicResource TextMutedBrush}">
                                    <Run Text="Remaining: "/>
                                    <Run Text="{Binding Remaining, StringFormat={}{0:N2} PLN, Mode=OneWay}"
                                         Foreground="{StaticResource SuccessBrush}"/>
                                </TextBlock>
                            </Grid>
                        </Border>
                    </DataTemplate>
                </ItemsControl.ItemTemplate>
            </ItemsControl>
        </Grid>
    </ScrollViewer>
</UserControl>
