<UserControl x:Class="SmartAlloc.Views.LoginView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             Background="#0F0E17">

    <UserControl.Resources>
        <!-- Shared numpad template -->
        <Style x:Key="LoginPrimaryBtn" TargetType="Button">
            <Setter Property="Background" Value="{StaticResource PrimaryGradientBrush}"/>
            <Setter Property="Foreground" Value="White"/>
            <Setter Property="FontSize" Value="15"/>
            <Setter Property="FontWeight" Value="SemiBold"/>
            <Setter Property="Cursor" Value="Hand"/>
            <Setter Property="Padding" Value="32,12"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="Button">
                        <Border Background="{TemplateBinding Background}" CornerRadius="12"
                                Padding="{TemplateBinding Padding}">
                            <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center"/>
                        </Border>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>
        <Style x:Key="LoginSecondaryBtn" TargetType="Button">
            <Setter Property="Background" Value="#2A2A4A"/>
            <Setter Property="Foreground" Value="White"/>
            <Setter Property="FontSize" Value="15"/>
            <Setter Property="FontWeight" Value="SemiBold"/>
            <Setter Property="Cursor" Value="Hand"/>
            <Setter Property="Padding" Value="32,12"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="Button">
                        <Border Background="{TemplateBinding Background}" CornerRadius="12"
                                Padding="{TemplateBinding Padding}">
                            <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center"/>
                        </Border>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>
        <Style x:Key="BackLinkBtn" TargetType="Button">
            <Setter Property="Background" Value="Transparent"/>
            <Setter Property="Foreground" Value="#A0A0C0"/>
            <Setter Property="FontSize" Value="13"/>
            <Setter Property="Cursor" Value="Hand"/>
            <Setter Property="BorderThickness" Value="0"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="Button">
                        <TextBlock Text="{TemplateBinding Content}" Foreground="{TemplateBinding Foreground}"
                                   FontSize="{TemplateBinding FontSize}" HorizontalAlignment="Center"/>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>
        <Style x:Key="LoginInputStyle" TargetType="TextBox">
            <Setter Property="Background" Value="#2A2A4A"/>
            <Setter Property="Foreground" Value="White"/>
            <Setter Property="FontSize" Value="14"/>
            <Setter Property="CaretBrush" Value="White"/>
            <Setter Property="Padding" Value="12,10"/>
            <Setter Property="BorderThickness" Value="0"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="TextBox">
                        <Border Background="{TemplateBinding Background}" CornerRadius="10"
                                Padding="{TemplateBinding Padding}">
                            <ScrollViewer x:Name="PART_ContentHost"/>
                        </Border>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>
    </UserControl.Resources>

    <Grid>
        <!-- ==================== WELCOME SCREEN ==================== -->
        <Border VerticalAlignment="Center" HorizontalAlignment="Center"
                Background="#1E1E3A" CornerRadius="24" Padding="48,40"
                MinWidth="380"
                Visibility="{Binding IsWelcome, Converter={StaticResource BoolToVisConverter}}">
            <Border.Effect>
                <DropShadowEffect BlurRadius="60" ShadowDepth="0" Color="#6C63FF" Opacity="0.2"/>
            </Border.Effect>
            <StackPanel HorizontalAlignment="Center">
                <Border Width="72" Height="72" CornerRadius="18"
                        Background="{StaticResource PrimaryGradientBrush}"
                        HorizontalAlignment="Center" Margin="0,0,0,16">
                    <TextBlock Text="ðŸ’°" FontSize="34"
                               HorizontalAlignment="Center" VerticalAlignment="Center"/>
                </Border>
                <TextBlock Text="SmartAlloc" FontSize="26" FontWeight="Bold"
                           Foreground="White" HorizontalAlignment="Center" Margin="0,0,0,6"/>
                <TextBlock Text="Your personal finance manager" FontSize="13"
                           Foreground="#A0A0C0" HorizontalAlignment="Center" Margin="0,0,0,32"/>

                <Button Content="Create Account" Style="{StaticResource LoginPrimaryBtn}"
                        HorizontalAlignment="Stretch" Margin="0,0,0,12"
                        Command="{Binding GoToCreateAccountCommand}"/>
                <Button Content="Log In" Style="{StaticResource LoginSecondaryBtn}"
                        HorizontalAlignment="Stretch"
                        Command="{Binding GoToLoginCommand}"/>
            </StackPanel>
        </Border>

        <!-- ==================== CREATE ACCOUNT SCREEN ==================== -->
        <Border VerticalAlignment="Center" HorizontalAlignment="Center"
                Background="#1E1E3A" CornerRadius="24" Padding="48,36"
                MinWidth="400"
                Visibility="{Binding IsCreateAccount, Converter={StaticResource BoolToVisConverter}}">
            <Border.Effect>
                <DropShadowEffect BlurRadius="60" ShadowDepth="0" Color="#6C63FF" Opacity="0.2"/>
            </Border.Effect>
            <StackPanel HorizontalAlignment="Center" Width="300">
                <TextBlock Text="Create Account" FontSize="22" FontWeight="Bold"
                           Foreground="White" HorizontalAlignment="Center" Margin="0,0,0,24"/>

                <!-- Avatar picker -->
                <Grid HorizontalAlignment="Center" Margin="0,0,0,20">
                    <Border Width="96" Height="96" CornerRadius="48"
                            Background="#2A2A4A" BorderBrush="#6C63FF" BorderThickness="2"
                            Cursor="Hand">
                        <Border.InputBindings>
                            <MouseBinding MouseAction="LeftClick" Command="{Binding PickAvatarCommand}"/>
                        </Border.InputBindings>
                        <Grid>
                            <!-- Default icon when no avatar -->
                            <TextBlock Text="ðŸ‘¤" FontSize="40"
                                       HorizontalAlignment="Center" VerticalAlignment="Center"
                                       Visibility="{Binding NewAvatarPath, Converter={StaticResource StringToVisConverter}, ConverterParameter=invert}"/>
                            <!-- Avatar preview -->
                            <Border CornerRadius="48" ClipToBounds="True"
                                    Visibility="{Binding NewAvatarPath, Converter={StaticResource StringToVisConverter}}">
                                <Image Source="{Binding NewAvatarPreview}" Width="96" Height="96"
                                       Stretch="UniformToFill"/>
                            </Border>
                        </Grid>
                    </Border>
                </Grid>
                <TextBlock Text="Tap to choose photo" FontSize="11" Foreground="#606080"
                           HorizontalAlignment="Center" Margin="0,0,0,20"/>

                <!-- Display Name -->
                <TextBlock Text="Display Name" Foreground="#A0A0C0" FontSize="12" Margin="0,0,0,6"/>
                <TextBox Style="{StaticResource LoginInputStyle}"
                         Text="{Binding NewDisplayName, UpdateSourceTrigger=PropertyChanged}"
                         Margin="0,0,0,16"/>

                <!-- PIN -->
                <TextBlock Text="PIN" Foreground="#A0A0C0" FontSize="12" Margin="0,0,0,6"/>
                <TextBox Style="{StaticResource LoginInputStyle}"
                         Text="{Binding NewPin, UpdateSourceTrigger=PropertyChanged}"
                         Margin="0,0,0,16"
                         MaxLength="0"
                         FontFamily="Consolas"
                         Tag="PIN"/>

                <!-- Confirm PIN -->
                <TextBlock Text="Confirm PIN" Foreground="#A0A0C0" FontSize="12" Margin="0,0,0,6"/>
                <TextBox Style="{StaticResource LoginInputStyle}"
                         Text="{Binding NewConfirmPin, UpdateSourceTrigger=PropertyChanged}"
                         Margin="0,0,0,20"
                         MaxLength="0"
                         FontFamily="Consolas"
                         Tag="Confirm PIN"/>

                <!-- Error -->
                <TextBlock Text="{Binding ErrorMessage}" Foreground="#E74C3C" FontSize="12"
                           HorizontalAlignment="Center" Margin="0,0,0,12"
                           Visibility="{Binding ErrorMessage, Converter={StaticResource StringToVisConverter}}"/>

                <Button Content="Create Account" Style="{StaticResource LoginPrimaryBtn}"
                        HorizontalAlignment="Stretch" Margin="0,0,0,12"
                        Command="{Binding CreateAccountCommand}"/>
                <Button Content="â† Back" Style="{StaticResource BackLinkBtn}"
                        HorizontalAlignment="Center"
                        Command="{Binding GoBackCommand}"/>
            </StackPanel>
        </Border>

        <!-- ==================== SELECT USER SCREEN ==================== -->
        <Border VerticalAlignment="Center" HorizontalAlignment="Center"
                Background="#1E1E3A" CornerRadius="24" Padding="48,40"
                MinWidth="520"
                Visibility="{Binding IsSelectUser, Converter={StaticResource BoolToVisConverter}}">
            <Border.Effect>
                <DropShadowEffect BlurRadius="60" ShadowDepth="0" Color="#6C63FF" Opacity="0.2"/>
            </Border.Effect>
            <StackPanel MinWidth="400">
                <TextBlock Text="Choose Account" FontSize="26" FontWeight="Bold"
                           Foreground="White" HorizontalAlignment="Center" Margin="0,0,0,28"/>

                <ItemsControl ItemsSource="{Binding Users}" Margin="0,0,0,24">
                    <ItemsControl.ItemTemplate>
                        <DataTemplate>
                            <Border x:Name="UserCard" Background="#2A2A4A" CornerRadius="14"
                                    Padding="18,14" Margin="0,0,0,12" MinHeight="76"
                                    Cursor="Hand">
                                <Border.InputBindings>
                                    <MouseBinding MouseAction="LeftClick"
                                                  Command="{Binding DataContext.SelectUserAccountCommand, RelativeSource={RelativeSource AncestorType=ItemsControl}}"
                                                  CommandParameter="{Binding}"/>
                                </Border.InputBindings>
                                <Grid VerticalAlignment="Center">
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="Auto"/>
                                        <ColumnDefinition Width="*"/>
                                        <ColumnDefinition Width="Auto"/>
                                    </Grid.ColumnDefinitions>
                                    <!-- Avatar -->
                                    <Border Grid.Column="0" Width="48" Height="48" CornerRadius="24"
                                            Background="#3A3A5A" ClipToBounds="True"
                                            Margin="0,0,14,0">
                                        <Grid>
                                            <TextBlock Text="ðŸ‘¤" FontSize="22"
                                                       HorizontalAlignment="Center" VerticalAlignment="Center"
                                                       Visibility="{Binding AvatarPath, Converter={StaticResource StringToVisConverter}, ConverterParameter=invert}"/>
                                            <Ellipse Width="48" Height="48"
                                                     Visibility="{Binding AvatarPath, Converter={StaticResource StringToVisConverter}}">
                                                <Ellipse.Fill>
                                                    <ImageBrush ImageSource="{Binding AvatarPath}" Stretch="UniformToFill"/>
                                                </Ellipse.Fill>
                                            </Ellipse>
                                        </Grid>
                                    </Border>
                                    <!-- Name -->
                                    <TextBlock Grid.Column="1" Text="{Binding DisplayName}"
                                               Foreground="White" FontSize="17" FontWeight="SemiBold"
                                               VerticalAlignment="Center"/>
                                    <!-- Arrow -->
                                    <TextBlock Grid.Column="2" Text="â€º" Foreground="#606080"
                                               FontSize="26" VerticalAlignment="Center" Margin="14,0,0,0"/>
                                </Grid>
                                <Border.Style>
                                    <Style TargetType="Border">
                                        <Style.Triggers>
                                            <Trigger Property="IsMouseOver" Value="True">
                                                <Setter Property="Background" Value="#3A3A5A"/>
                                            </Trigger>
                                        </Style.Triggers>
                                    </Style>
                                </Border.Style>
                            </Border>
                        </DataTemplate>
                    </ItemsControl.ItemTemplate>
                </ItemsControl>

                <Button Content="â† Back" Style="{StaticResource BackLinkBtn}"
                        HorizontalAlignment="Center"
                        Command="{Binding GoBackCommand}"/>
            </StackPanel>
        </Border>

        <!-- ==================== ENTER PIN SCREEN ==================== -->
        <Border VerticalAlignment="Center" HorizontalAlignment="Center"
                Background="#1E1E3A" CornerRadius="24" Padding="48,36"
                MinWidth="380"
                Visibility="{Binding IsEnterPin, Converter={StaticResource BoolToVisConverter}}">
            <Border.Effect>
                <DropShadowEffect BlurRadius="60" ShadowDepth="0" Color="#6C63FF" Opacity="0.2"/>
            </Border.Effect>
            <StackPanel HorizontalAlignment="Center">
                <!-- Selected user avatar + name -->
                <Border Width="72" Height="72" CornerRadius="36"
                        Background="#2A2A4A" ClipToBounds="True"
                        HorizontalAlignment="Center" Margin="0,0,0,12">
                    <Grid>
                        <TextBlock Text="ðŸ‘¤" FontSize="34"
                                   HorizontalAlignment="Center" VerticalAlignment="Center"/>
                        <Image Source="{Binding SelectedUserAvatar}" Width="72" Height="72"
                               Stretch="UniformToFill"/>
                    </Grid>
                </Border>
                <TextBlock Text="{Binding SelectedUser.DisplayName}" FontSize="18" FontWeight="SemiBold"
                           Foreground="White" HorizontalAlignment="Center" Margin="0,0,0,4"/>
                <TextBlock Text="Enter your PIN" FontSize="13"
                           Foreground="#A0A0C0" HorizontalAlignment="Center" Margin="0,0,0,20"/>

                <!-- PIN dots (dynamic) -->
                <ItemsControl HorizontalAlignment="Center" Margin="0,0,0,16">
                    <ItemsControl.ItemsPanel>
                        <ItemsPanelTemplate>
                            <StackPanel Orientation="Horizontal"/>
                        </ItemsPanelTemplate>
                    </ItemsControl.ItemsPanel>
                    <ItemsControl.ItemsSource>
                        <Binding Path="LoginPin" Converter="{StaticResource PinDotsConverter}"/>
                    </ItemsControl.ItemsSource>
                    <ItemsControl.ItemTemplate>
                        <DataTemplate>
                            <Ellipse Width="14" Height="14" Margin="5,0"
                                     Fill="{StaticResource PrimaryGradientBrush}"/>
                        </DataTemplate>
                    </ItemsControl.ItemTemplate>
                </ItemsControl>

                <!-- Error -->
                <TextBlock Text="{Binding ErrorMessage}" Foreground="#E74C3C" FontSize="12"
                           HorizontalAlignment="Center" Margin="0,0,0,12"
                           Visibility="{Binding ErrorMessage, Converter={StaticResource StringToVisConverter}}"/>

                <!-- Numpad -->
                <UniformGrid Columns="3" HorizontalAlignment="Center" Margin="0,0,0,12">
                    <Button Content="1" Style="{StaticResource PinPadButtonStyle}" Command="{Binding PinDigitCommand}" CommandParameter="1"/>
                    <Button Content="2" Style="{StaticResource PinPadButtonStyle}" Command="{Binding PinDigitCommand}" CommandParameter="2"/>
                    <Button Content="3" Style="{StaticResource PinPadButtonStyle}" Command="{Binding PinDigitCommand}" CommandParameter="3"/>
                    <Button Content="4" Style="{StaticResource PinPadButtonStyle}" Command="{Binding PinDigitCommand}" CommandParameter="4"/>
                    <Button Content="5" Style="{StaticResource PinPadButtonStyle}" Command="{Binding PinDigitCommand}" CommandParameter="5"/>
                    <Button Content="6" Style="{StaticResource PinPadButtonStyle}" Command="{Binding PinDigitCommand}" CommandParameter="6"/>
                    <Button Content="7" Style="{StaticResource PinPadButtonStyle}" Command="{Binding PinDigitCommand}" CommandParameter="7"/>
                    <Button Content="8" Style="{StaticResource PinPadButtonStyle}" Command="{Binding PinDigitCommand}" CommandParameter="8"/>
                    <Button Content="9" Style="{StaticResource PinPadButtonStyle}" Command="{Binding PinDigitCommand}" CommandParameter="9"/>
                    <Button Content="âŒ«" Style="{StaticResource PinPadButtonStyle}" Command="{Binding PinBackspaceCommand}"/>
                    <Button Content="0" Style="{StaticResource PinPadButtonStyle}" Command="{Binding PinDigitCommand}" CommandParameter="0"/>
                    <Button Content="âœ“" Style="{StaticResource PinPadSubmitStyle}" Command="{Binding SubmitPinCommand}"/>
                </UniformGrid>

                <Button Content="â† Back" Style="{StaticResource BackLinkBtn}"
                        HorizontalAlignment="Center"
                        Command="{Binding GoBackCommand}"/>
            </StackPanel>
        </Border>
    </Grid>
</UserControl>
