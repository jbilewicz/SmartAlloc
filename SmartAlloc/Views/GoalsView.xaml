<UserControl x:Class="SmartAlloc.Views.GoalsView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:vm="clr-namespace:SmartAlloc.ViewModels"
             Background="{DynamicResource BackgroundBrush}">

    <ScrollViewer Style="{StaticResource ScrollViewerStyle}">
        <Grid Margin="28,20,28,28">
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="*"/>
            </Grid.RowDefinitions>

            <!-- Header -->
            <StackPanel Grid.Row="0" Margin="0,0,0,4">
                <TextBlock Text="Savings Goals" Style="{StaticResource PageTitleStyle}"/>
                <TextBlock Text="Track progress and predict goal achievement date" Style="{StaticResource PageSubtitleStyle}"/>
            </StackPanel>

            <!-- Add Goal Form -->
            <Border Grid.Row="1" Style="{StaticResource GlassCardStyle}" Margin="0,0,0,24">
                <StackPanel>
                    <TextBlock Text="🎯 New savings goal" Style="{StaticResource SectionTitleStyle}"/>

                    <Grid>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="80"/>
                            <ColumnDefinition Width="12"/>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="12"/>
                            <ColumnDefinition Width="140"/>
                            <ColumnDefinition Width="12"/>
                            <ColumnDefinition Width="140"/>
                        </Grid.ColumnDefinitions>

                        <StackPanel Grid.Column="0">
                            <TextBlock Text="Icon" Style="{StaticResource LabelStyle}"/>
                            <ComboBox ItemsSource="{Binding AvailableIcons}"
                                      SelectedItem="{Binding NewIcon}"
                                      Style="{StaticResource DarkComboStyle}"/>
                        </StackPanel>

                        <StackPanel Grid.Column="2">
                            <TextBlock Text="Goal name" Style="{StaticResource LabelStyle}"/>
                            <TextBox Text="{Binding NewName, UpdateSourceTrigger=PropertyChanged}"
                                     Style="{StaticResource DarkInputStyle}"/>
                        </StackPanel>

                        <StackPanel Grid.Column="4">
                            <TextBlock Text="Target amount (PLN)" Style="{StaticResource LabelStyle}"/>
                            <TextBox Text="{Binding NewTargetAmount, StringFormat={}{0:N2}, UpdateSourceTrigger=PropertyChanged}"
                                     Style="{StaticResource DarkInputStyle}"/>
                        </StackPanel>

                        <StackPanel Grid.Column="6">
                            <TextBlock Text="Already saved (PLN)" Style="{StaticResource LabelStyle}"/>
                            <TextBox Text="{Binding NewCurrentAmount, StringFormat={}{0:N2}, UpdateSourceTrigger=PropertyChanged}"
                                     Style="{StaticResource DarkInputStyle}"/>
                        </StackPanel>
                    </Grid>

                    <Button Content="✅ Create goal"
                            Command="{Binding AddGoalCommand}"
                            Style="{StaticResource PrimaryButtonStyle}"
                            HorizontalAlignment="Left"
                            Margin="0,16,0,0"/>
                </StackPanel>
            </Border>

            <!-- Goal Cards -->
            <ItemsControl Grid.Row="2" ItemsSource="{Binding GoalItems}">
                <ItemsControl.ItemsPanel>
                    <ItemsPanelTemplate>
                        <WrapPanel/>
                    </ItemsPanelTemplate>
                </ItemsControl.ItemsPanel>
                <ItemsControl.ItemTemplate>
                    <DataTemplate DataType="{x:Type vm:GoalItemVM}">
                        <Border Style="{StaticResource GlassCardStyle}"
                                Width="300" Margin="0,0,16,16">
                            <Grid>
                                <Grid.RowDefinitions>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="Auto"/>
                                </Grid.RowDefinitions>

                                <!-- Title row -->
                                <Grid Grid.Row="0" Margin="0,0,0,12">
                                    <StackPanel Orientation="Horizontal">
                                        <Border Width="40" Height="40" CornerRadius="10"
                                                Background="{StaticResource PrimaryGradientBrush}"
                                                Margin="0,0,12,0">
                                            <TextBlock Text="{Binding Goal.Icon}" FontSize="20"
                                                       HorizontalAlignment="Center" VerticalAlignment="Center"/>
                                        </Border>
                                        <StackPanel VerticalAlignment="Center">
                                            <TextBlock Text="{Binding Goal.Name}"
                                                       FontSize="15" FontWeight="SemiBold"
                                                       Foreground="{DynamicResource TextPrimaryBrush}"/>
                                            <TextBlock Text="{Binding PredictedDate}"
                                                       FontSize="10" Foreground="{StaticResource AccentBrush}"/>
                                        </StackPanel>
                                    </StackPanel>
                                    <Button Content="✕"
                                            Command="{Binding DataContext.DeleteGoalCommand,
                                                RelativeSource={RelativeSource AncestorType=ItemsControl}}"
                                            CommandParameter="{Binding}"
                                            Background="Transparent" BorderThickness="0"
                                            Foreground="{DynamicResource TextMutedBrush}"
                                            Cursor="Hand" FontSize="12" Padding="4"
                                            HorizontalAlignment="Right" VerticalAlignment="Top"/>
                                </Grid>

                                <!-- Progress text -->
                                <Grid Grid.Row="1" Margin="0,0,0,6">
                                    <TextBlock Text="{Binding ProgressText}"
                                               FontSize="13" Foreground="{DynamicResource TextSecondaryBrush}"/>
                                    <TextBlock Text="{Binding Progress, StringFormat={}{0:N0}%}"
                                               FontSize="13" FontWeight="Bold" HorizontalAlignment="Right">
                                        <TextBlock.Foreground>
                                            <SolidColorBrush Color="{Binding StatusColor}"/>
                                        </TextBlock.Foreground>
                                    </TextBlock>
                                </Grid>

                                <!-- Progress bar -->
                                <ProgressBar Grid.Row="2"
                                             Value="{Binding Progress, Mode=OneWay}"
                                             Maximum="100"
                                             Style="{StaticResource ProgressBarStyle}"
                                             Height="10" Margin="0,0,0,12">
                                    <ProgressBar.Foreground>
                                        <SolidColorBrush Color="{Binding StatusColor}"/>
                                    </ProgressBar.Foreground>
                                </ProgressBar>

                                <!-- Remaining -->
                                <TextBlock Grid.Row="3" FontSize="11"
                                           Foreground="{DynamicResource TextMutedBrush}"
                                           Margin="0,0,0,12">
                                    <Run Text="Remaining: "/>
                                    <Run Text="{Binding Goal.RemainingAmount, StringFormat={}{0:N2} PLN, Mode=OneWay}"
                                         Foreground="{StaticResource WarningBrush}"/>
                                </TextBlock>

                                <!-- Deposit row -->
                                <Grid Grid.Row="4">
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="*"/>
                                        <ColumnDefinition Width="8"/>
                                        <ColumnDefinition Width="Auto"/>
                                    </Grid.ColumnDefinitions>
                                    <TextBox Grid.Column="0"
                                             Text="{Binding DepositAmount,
                                                StringFormat={}{0:N2}, UpdateSourceTrigger=PropertyChanged}"
                                             Style="{StaticResource DarkInputStyle}"/>
                                    <Button Grid.Column="2"
                                            Content="💰 Deposit"
                                            Command="{Binding DataContext.DepositCommand,
                                                RelativeSource={RelativeSource AncestorType=ItemsControl}}"
                                            CommandParameter="{Binding}"
                                            Style="{StaticResource SuccessButtonStyle}"
                                            Padding="12,8" FontSize="12"/>
                                </Grid>
                            </Grid>
                        </Border>
                    </DataTemplate>
                </ItemsControl.ItemTemplate>
            </ItemsControl>
        </Grid>
    </ScrollViewer>
</UserControl>
