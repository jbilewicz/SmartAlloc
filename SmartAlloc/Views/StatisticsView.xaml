<UserControl x:Class="SmartAlloc.Views.StatisticsView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:lvc="clr-namespace:LiveChartsCore.SkiaSharpView.WPF;assembly=LiveChartsCore.SkiaSharpView.WPF"
             xmlns:svc="clr-namespace:SmartAlloc.Services"
             Background="{DynamicResource BackgroundBrush}">

    <ScrollViewer Style="{StaticResource ScrollViewerStyle}">
        <Grid Margin="28,20,28,28">
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="Auto"/>
            </Grid.RowDefinitions>

            <StackPanel Grid.Row="0" Margin="0,0,0,4">
                <TextBlock Text="{Binding [Title.AdvancedStats], Source={StaticResource Loc}}" Style="{StaticResource PageTitleStyle}"/>
                <TextBlock Text="{Binding [Title.AdvancedStatsSub], Source={StaticResource Loc}}" Style="{StaticResource PageSubtitleStyle}"/>
            </StackPanel>

            <UniformGrid Grid.Row="1" Columns="4" Margin="0,0,0,24">
                <Border Style="{StaticResource KpiCardStyle}"
                        Background="{StaticResource KpiExpenseGradientBrush}" Margin="0,0,12,0">
                    <StackPanel>
                        <TextBlock Text="{Binding [Label.AvgDailyExpense], Source={StaticResource Loc}}" FontSize="11" Foreground="{DynamicResource TextMutedBrush}"/>
                        <TextBlock FontSize="22" FontWeight="Bold" Foreground="#E74C3C" Margin="0,6,0,0">
                            <TextBlock.Text>
                                <MultiBinding Converter="{StaticResource MoneyDisplayConverter}">
                                    <Binding Path="AvgDailyExpense"/>
                                    <Binding Source="{x:Static svc:PrivacyService.Current}" Path="IsPrivate"/>
                                    <Binding Source="{x:Static svc:CurrencyDisplayService.Current}" Path="SelectedCurrency"/>
                                </MultiBinding>
                            </TextBlock.Text>
                        </TextBlock>
                    </StackPanel>
                </Border>
                <Border Style="{StaticResource KpiCardStyle}"
                        Background="{StaticResource KpiIncomeGradientBrush}" Margin="0,0,12,0">
                    <StackPanel>
                        <TextBlock Text="{Binding [Label.AvgDailyIncome], Source={StaticResource Loc}}" FontSize="11" Foreground="{DynamicResource TextMutedBrush}"/>
                        <TextBlock FontSize="22" FontWeight="Bold" Foreground="#27AE60" Margin="0,6,0,0">
                            <TextBlock.Text>
                                <MultiBinding Converter="{StaticResource MoneyDisplayConverter}">
                                    <Binding Path="AvgDailyIncome"/>
                                    <Binding Source="{x:Static svc:PrivacyService.Current}" Path="IsPrivate"/>
                                    <Binding Source="{x:Static svc:CurrencyDisplayService.Current}" Path="SelectedCurrency"/>
                                </MultiBinding>
                            </TextBlock.Text>
                        </TextBlock>
                    </StackPanel>
                </Border>
                <Border Style="{StaticResource KpiCardStyle}"
                        Background="{StaticResource KpiBalanceGradientBrush}" Margin="0,0,12,0">
                    <StackPanel>
                        <TextBlock Text="{Binding [Label.SavingsRate], Source={StaticResource Loc}}" FontSize="11" Foreground="{DynamicResource TextMutedBrush}"/>
                        <TextBlock Text="{Binding SavingsRate}" FontSize="22" FontWeight="Bold"
                                   Foreground="{StaticResource AccentBrush}" Margin="0,6,0,0"/>
                    </StackPanel>
                </Border>
                <Border Style="{StaticResource KpiCardStyle}"
                        Background="{StaticResource KpiConverterGradientBrush}">
                    <StackPanel>
                        <TextBlock Text="{Binding [Label.BiggestExpense], Source={StaticResource Loc}}" FontSize="11" Foreground="{DynamicResource TextMutedBrush}"/>
                        <TextBlock FontSize="22" FontWeight="Bold" Foreground="#F39C12" Margin="0,6,0,0">
                            <TextBlock.Text>
                                <MultiBinding Converter="{StaticResource MoneyDisplayConverter}">
                                    <Binding Path="BiggestExpense"/>
                                    <Binding Source="{x:Static svc:PrivacyService.Current}" Path="IsPrivate"/>
                                    <Binding Source="{x:Static svc:CurrencyDisplayService.Current}" Path="SelectedCurrency"/>
                                </MultiBinding>
                            </TextBlock.Text>
                        </TextBlock>
                        <TextBlock Text="{Binding BiggestExpenseCategory}" FontSize="11"
                                   Foreground="{DynamicResource TextMutedBrush}" Margin="0,2,0,0"/>
                    </StackPanel>
                </Border>
            </UniformGrid>

            <Border Grid.Row="2" Style="{StaticResource GlassCardStyle}" Margin="0,0,0,24">
                <StackPanel>
                    <TextBlock Text="{Binding [Section.TopExpense], Source={StaticResource Loc}}" Style="{StaticResource SectionTitleStyle}"/>
                    <ItemsControl ItemsSource="{Binding TopExpenseCategories}">
                        <ItemsControl.ItemTemplate>
                            <DataTemplate>
                                <Grid Margin="0,4">
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="200"/>
                                        <ColumnDefinition Width="*"/>
                                        <ColumnDefinition Width="120"/>
                                        <ColumnDefinition Width="60"/>
                                    </Grid.ColumnDefinitions>
                                    <TextBlock Grid.Column="0" Text="{Binding Name}" FontSize="13"
                                               Foreground="{DynamicResource TextPrimaryBrush}"
                                               VerticalAlignment="Center"/>
                                    <ProgressBar Grid.Column="1" Value="{Binding Percentage, Mode=OneWay}"
                                                 Maximum="100" Style="{StaticResource ProgressBarStyle}"
                                                 Height="8" Margin="12,0"
                                                 Foreground="{StaticResource PrimaryBrush}"/>
                                    <TextBlock Grid.Column="2" FontSize="13" FontWeight="SemiBold"
                                               Foreground="{DynamicResource TextPrimaryBrush}"
                                               VerticalAlignment="Center" HorizontalAlignment="Right">
                                        <TextBlock.Text>
                                            <MultiBinding Converter="{StaticResource MoneyDisplayConverter}">
                                                <Binding Path="Amount"/>
                                                <Binding Source="{x:Static svc:PrivacyService.Current}" Path="IsPrivate"/>
                                                <Binding Source="{x:Static svc:CurrencyDisplayService.Current}" Path="SelectedCurrency"/>
                                            </MultiBinding>
                                        </TextBlock.Text>
                                    </TextBlock>
                                    <TextBlock Grid.Column="3" FontSize="12"
                                               Foreground="{DynamicResource TextMutedBrush}"
                                               VerticalAlignment="Center" HorizontalAlignment="Right"
                                               Text="{Binding Percentage, StringFormat={}{0:N1}%}"/>
                                </Grid>
                            </DataTemplate>
                        </ItemsControl.ItemTemplate>
                    </ItemsControl>
                </StackPanel>
            </Border>

            <Border Grid.Row="3" Style="{StaticResource GlassCardStyle}" Margin="0,0,0,24">
                <StackPanel>
                    <TextBlock Text="{Binding [Section.IncomeVsExpense], Source={StaticResource Loc}}" Style="{StaticResource SectionTitleStyle}"/>
                    <lvc:CartesianChart Height="280"
                                        Series="{Binding ComparisonSeries}"
                                        XAxes="{Binding ComparisonXAxes}"
                                        YAxes="{Binding ComparisonYAxes}"
                                        TooltipTextPaint="{x:Null}"
                                        UseLayoutRounding="True"
                                        RenderOptions.BitmapScalingMode="NearestNeighbor"/>
                </StackPanel>
            </Border>

            <Border Grid.Row="4" Style="{StaticResource GlassCardStyle}" Margin="0,0,0,24">
                <StackPanel>
                    <TextBlock Text="{Binding [Section.ExpenseTrend], Source={StaticResource Loc}}" Style="{StaticResource SectionTitleStyle}"/>
                    <lvc:CartesianChart Height="260"
                                        Series="{Binding TrendSeries}"
                                        XAxes="{Binding TrendXAxes}"
                                        YAxes="{Binding TrendYAxes}"
                                        TooltipTextPaint="{x:Null}"
                                        UseLayoutRounding="True"
                                        RenderOptions.BitmapScalingMode="NearestNeighbor"/>
                </StackPanel>
            </Border>
        </Grid>
    </ScrollViewer>
</UserControl>
