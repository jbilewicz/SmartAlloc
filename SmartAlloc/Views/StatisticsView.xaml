<UserControl x:Class="SmartAlloc.Views.StatisticsView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:lvc="clr-namespace:LiveChartsCore.SkiaSharpView.WPF;assembly=LiveChartsCore.SkiaSharpView.WPF"
             Background="{DynamicResource BackgroundBrush}">

    <ScrollViewer Style="{StaticResource ScrollViewerStyle}">
        <Grid Margin="28,20,28,28">
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="Auto"/>
            </Grid.RowDefinitions>

            <!-- Header -->
            <StackPanel Grid.Row="0" Margin="0,0,0,4">
                <TextBlock Text="Advanced Statistics" Style="{StaticResource PageTitleStyle}"/>
                <TextBlock Text="Detailed analysis of your spending and income patterns" Style="{StaticResource PageSubtitleStyle}"/>
            </StackPanel>

            <!-- KPI Cards -->
            <UniformGrid Grid.Row="1" Columns="4" Margin="0,0,0,24">
                <Border Style="{StaticResource KpiCardStyle}"
                        Background="{StaticResource KpiExpenseGradientBrush}" Margin="0,0,12,0">
                    <StackPanel>
                        <TextBlock Text="ðŸ“‰ Avg Daily Expense" FontSize="11" Foreground="{DynamicResource TextMutedBrush}"/>
                        <TextBlock FontSize="22" FontWeight="Bold" Foreground="#E74C3C" Margin="0,6,0,0">
                            <TextBlock.Text>
                                <MultiBinding StringFormat="{}{0:N2} PLN">
                                    <Binding Path="AvgDailyExpense"/>
                                </MultiBinding>
                            </TextBlock.Text>
                        </TextBlock>
                    </StackPanel>
                </Border>
                <Border Style="{StaticResource KpiCardStyle}"
                        Background="{StaticResource KpiIncomeGradientBrush}" Margin="0,0,12,0">
                    <StackPanel>
                        <TextBlock Text="ðŸ“ˆ Avg Daily Income" FontSize="11" Foreground="{DynamicResource TextMutedBrush}"/>
                        <TextBlock FontSize="22" FontWeight="Bold" Foreground="#27AE60" Margin="0,6,0,0">
                            <TextBlock.Text>
                                <MultiBinding StringFormat="{}{0:N2} PLN">
                                    <Binding Path="AvgDailyIncome"/>
                                </MultiBinding>
                            </TextBlock.Text>
                        </TextBlock>
                    </StackPanel>
                </Border>
                <Border Style="{StaticResource KpiCardStyle}"
                        Background="{StaticResource KpiBalanceGradientBrush}" Margin="0,0,12,0">
                    <StackPanel>
                        <TextBlock Text="ðŸ’¾ Savings Rate" FontSize="11" Foreground="{DynamicResource TextMutedBrush}"/>
                        <TextBlock Text="{Binding SavingsRate}" FontSize="22" FontWeight="Bold"
                                   Foreground="{StaticResource AccentBrush}" Margin="0,6,0,0"/>
                    </StackPanel>
                </Border>
                <Border Style="{StaticResource KpiCardStyle}"
                        Background="{StaticResource KpiConverterGradientBrush}">
                    <StackPanel>
                        <TextBlock Text="ðŸ”¥ Biggest Expense" FontSize="11" Foreground="{DynamicResource TextMutedBrush}"/>
                        <TextBlock FontSize="22" FontWeight="Bold" Foreground="#F39C12" Margin="0,6,0,0">
                            <TextBlock.Text>
                                <MultiBinding StringFormat="{}{0:N2} PLN">
                                    <Binding Path="BiggestExpense"/>
                                </MultiBinding>
                            </TextBlock.Text>
                        </TextBlock>
                        <TextBlock Text="{Binding BiggestExpenseCategory}" FontSize="11"
                                   Foreground="{DynamicResource TextMutedBrush}" Margin="0,2,0,0"/>
                    </StackPanel>
                </Border>
            </UniformGrid>

            <!-- Top Expense Categories -->
            <Border Grid.Row="2" Style="{StaticResource GlassCardStyle}" Margin="0,0,0,24">
                <StackPanel>
                    <TextBlock Text="ðŸ† Top Expense Categories (this month)" Style="{StaticResource SectionTitleStyle}"/>
                    <ItemsControl ItemsSource="{Binding TopExpenseCategories}">
                        <ItemsControl.ItemTemplate>
                            <DataTemplate>
                                <Grid Margin="0,4">
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="200"/>
                                        <ColumnDefinition Width="*"/>
                                        <ColumnDefinition Width="120"/>
                                        <ColumnDefinition Width="60"/>
                                    </Grid.ColumnDefinitions>
                                    <TextBlock Grid.Column="0" Text="{Binding Name}" FontSize="13"
                                               Foreground="{DynamicResource TextPrimaryBrush}"
                                               VerticalAlignment="Center"/>
                                    <ProgressBar Grid.Column="1" Value="{Binding Percentage, Mode=OneWay}"
                                                 Maximum="100" Style="{StaticResource ProgressBarStyle}"
                                                 Height="8" Margin="12,0"
                                                 Foreground="{StaticResource PrimaryBrush}"/>
                                    <TextBlock Grid.Column="2" FontSize="13" FontWeight="SemiBold"
                                               Foreground="{DynamicResource TextPrimaryBrush}"
                                               VerticalAlignment="Center" HorizontalAlignment="Right">
                                        <TextBlock.Text>
                                            <MultiBinding StringFormat="{}{0:N2} PLN">
                                                <Binding Path="Amount"/>
                                            </MultiBinding>
                                        </TextBlock.Text>
                                    </TextBlock>
                                    <TextBlock Grid.Column="3" FontSize="12"
                                               Foreground="{DynamicResource TextMutedBrush}"
                                               VerticalAlignment="Center" HorizontalAlignment="Right"
                                               Text="{Binding Percentage, StringFormat={}{0:N1}%}"/>
                                </Grid>
                            </DataTemplate>
                        </ItemsControl.ItemTemplate>
                    </ItemsControl>
                </StackPanel>
            </Border>

            <!-- Income vs Expenses comparison -->
            <Border Grid.Row="3" Style="{StaticResource GlassCardStyle}" Margin="0,0,0,24">
                <StackPanel>
                    <TextBlock Text="ðŸ“Š Income vs Expenses (6 months)" Style="{StaticResource SectionTitleStyle}"/>
                    <lvc:CartesianChart Height="280"
                                        Series="{Binding ComparisonSeries}"
                                        XAxes="{Binding ComparisonXAxes}"
                                        YAxes="{Binding ComparisonYAxes}"
                                        TooltipTextPaint="{x:Null}"
                                        UseLayoutRounding="True"
                                        RenderOptions.BitmapScalingMode="NearestNeighbor"/>
                </StackPanel>
            </Border>

            <!-- Expense trend -->
            <Border Grid.Row="4" Style="{StaticResource GlassCardStyle}" Margin="0,0,0,24">
                <StackPanel>
                    <TextBlock Text="ðŸ“ˆ Expense Trend (12 months)" Style="{StaticResource SectionTitleStyle}"/>
                    <lvc:CartesianChart Height="260"
                                        Series="{Binding TrendSeries}"
                                        XAxes="{Binding TrendXAxes}"
                                        YAxes="{Binding TrendYAxes}"
                                        TooltipTextPaint="{x:Null}"
                                        UseLayoutRounding="True"
                                        RenderOptions.BitmapScalingMode="NearestNeighbor"/>
                </StackPanel>
            </Border>
        </Grid>
    </ScrollViewer>
</UserControl>
